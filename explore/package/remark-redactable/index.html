<!doctypehtml><html lang=en><meta charset=utf8><title>remark-redactable - unified</title><meta content="width=device-width,initial-scale=1"name=viewport><link href=https://github.com rel=preconnect><link href=https://images.opencollective.com rel=preconnect><link href=https://twitter-avatar.now.sh rel=preconnect><link href=https://www.npmjs.com rel=preconnect><link href=https://bundlephobia.com rel=preconnect><link href=https://www.npmtrends.com rel=preconnect><link href=/syntax-light.css rel=stylesheet><link href=/index.css rel=stylesheet><link href=/big.css rel=stylesheet media=(min-width:36em)><link href=/syntax-dark.css rel=stylesheet media=(prefers-color-scheme:dark)><link href=/dark.css rel=stylesheet media=(prefers-color-scheme:dark)><link href=https://unifiedjs.com/explore/package/remark-redactable/ rel=canonical><meta content="remark plugin to enable other plugins for redaction and restoration of content"name=description><meta content=unified,parse,stringify,process,ast,transform name=keywords><meta content="unified collective"name=author><meta content="© 2020 unified collective"name=copyright><meta content=#0366d6 name=theme-color><meta content=website property=og:type><meta content=unified property=og:site_name><meta content=https://unifiedjs.com/explore/package/remark-redactable/ property=og:url><meta content=remark-redactable property=og:title><meta content="remark plugin to enable other plugins for redaction and restoration of content"property=og:description><meta content=https://unifiedjs.com/image/cover-1200.png property=og:image><meta content="We compile content to syntax trees and syntax trees to content. We also provide hundreds of packages to work on the trees in between. You can build on the unified collective to make all kinds of interesting things."property=og:image:alt><meta content=1200 property=og:image:width><meta content=690 property=og:image:height><meta content=summary_large_image name=twitter:card><meta content=https://unifiedjs.com/image/cover-1200.png name=twitter:image><meta content="We compile content to syntax trees and syntax trees to content. We also provide hundreds of packages to work on the trees in between. You can build on the unified collective to make all kinds of interesting things."name=twitter:image:alt><meta content=@unifiedjs name=twitter:site><script defer src=/search.js></script><header class=container><div class=row-l><h1><a href=/ class=unified><span class=hl>uni</span>fied</a></h1><nav class="flex row-l"aria-label="Main navigation"><ol class="row flex"><li><a href=/explore/>Explore</a><li><a href=/learn/>Learn</a><li><a href=/community/>Community</a></ol><ol class="row justify-end-l x-show-l"><li><a href=https://twitter.com/unifiedjs><svg class="icon x-show-l"height=24 viewBox="0 0 18 14"width=24 aria-label=Twitter role=img><path d="M18 1.684l-1.687 1.684v.28c0 .307-.05.602-.123.886-.04 2.316-.777 5.387-3.816 7.81C6.404 17.115 0 12.907 0 12.907c5.063 0 5.063-1.684 5.063-1.684-1.126 0-3.376-2.243-3.376-2.243.563.56 1.689 0 1.689 0C.56 7.295.56 5.61.56 5.61c.563.561 1.689 0 1.689 0C-.563 3.368 1.124.561 1.124.561 1.687 3.368 9 4.49 9 4.49l.093-.046A6.637 6.637 0 0 1 9 3.368C9 1.353 10.636 0 12.656 0c1.112 0 2.094.506 2.765 1.286l.329-.163L17.437 0l-1.122 2.245L18 1.684z"fill=currentcolor /></svg><span class=x-hide-l>Twitter</span></a><li><a href=https://github.com/unifiedjs><svg class="icon x-show-l"height=24 viewBox="0 0 48 48"width=24 aria-label=GitHub role=img><path d="M23.928 1.15C11 1.15.514 11.638.514 24.566c0 10.343 6.75 19.105 15.945 22.265 1.148.144 1.58-.574 1.58-1.15v-4.02c-6.465 1.436-7.902-3.16-7.902-3.16-1.005-2.73-2.586-3.45-2.586-3.45-2.154-1.435.144-1.435.144-1.435 2.298.144 3.59 2.442 3.59 2.442 2.156 3.59 5.46 2.586 6.753 2.01.142-1.58.86-2.585 1.435-3.16-5.17-.574-10.63-2.585-10.63-11.635 0-2.585.862-4.596 2.442-6.32-.287-.575-1.005-3.017.288-6.177 0 0 2.01-.574 6.464 2.442 1.866-.574 3.877-.718 5.888-.718 2.01 0 4.022.286 5.89.717 4.453-3.016 6.464-2.442 6.464-2.442 1.293 3.16.43 5.602.287 6.177a9.29 9.29 0 012.44 6.32c0 9.05-5.458 10.918-10.63 11.492.863.718 1.58 2.155 1.58 4.31v6.464c0 .574.432 1.292 1.58 1.15 9.338-3.16 15.946-11.924 15.946-22.266-.143-12.785-10.63-23.27-23.558-23.27z"fill=currentcolor fill-rule=evenodd clip-rule=evenodd /></svg><span class=x-hide-l>GitHub</span></a></ol></nav></div></header><section class=container><div class="row-l column-nl"><hgroup class=column><h2><span class="label x-hide-l medlight">Project:</span><a href=/explore/project/code-dot-org>code-dot-org</a><span class="lowlight separator">/</span><a href=/explore/project/code-dot-org/remark-redactable>remark-redactable</a></h2><h3 class=content><span class="label x-hide-l medlight">Package:</span><a href=/explore/package/remark-redactable>remark-redactable</a><span class="lowlight separator">@</span><span class=medlight>1.0.0</span></h3></hgroup><ol class="flex column ellipsis-l"><li><a href=https://www.npmjs.com/package/remark-redactable class=tap-target><span class=label>Dependencies:</span>0</a><span class="lowlight separator">·</span><a href=https://www.npmjs.com/browse/depended/remark-redactable class=tap-target><span class=label>Dependents:</span>1</a><li class="content ellipsis">remark plugin to enable other plugins for redaction and restoration of content</ol><div class=column><ol class="row justify-end-l"><li style=color:#bcc540><svg class=icon height=18 viewBox="0 0 12 16"width=18 aria-label=Score role=img><path d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"fill=currentcolor fill-rule=evenodd /></svg> 66%<li><a href=http://www.apache.org/licenses/LICENSE-2.0 class=tap-target><svg class=icon height=18 viewBox="0 0 14 16"width=18 aria-label=License role=img><path d="M7 4c-.83 0-1.5-.67-1.5-1.5S6.17 1 7 1s1.5.67 1.5 1.5S7.83 4 7 4zm7 6c0 1.11-.89 2-2 2h-1c-1.11 0-2-.89-2-2l2-4h-1c-.55 0-1-.45-1-1H8v8c.42 0 1 .45 1 1h1c.42 0 1 .45 1 1H3c0-.55.58-1 1-1h1c0-.55.58-1 1-1h.03L6 5H5c0 .55-.45 1-1 1H3l2 4c0 1.11-.89 2-2 2H2c-1.11 0-2-.89-2-2l2-4H1V5h3c0-.55.45-1 1-1h4c.55 0 1 .45 1 1h3v1h-1l2 4zM2.5 7L1 10h3L2.5 7zM13 10l-1.5-3-1.5 3h3z"fill=currentcolor fill-rule=evenodd /></svg> Apache-2.0</a><li><a href=https://github.com/code-dot-org/remark-redactable/stargazers class=tap-target><svg class=icon height=18 viewBox="0 0 14 16"width=18 aria-label=Stars role=img><path d="M14 6l-4.9-.64L7 1 4.9 5.36 0 6l3.6 3.26L2.67 14 7 11.67 11.33 14l-.93-4.74L14 6z"fill=currentcolor fill-rule=evenodd /></svg> 1</a><li><a href=https://github.com/code-dot-org/remark-redactable class=tap-target><svg class=icon height=18 viewBox="0 0 48 48"width=18 aria-label=GitHub role=img><path d="M23.928 1.15C11 1.15.514 11.638.514 24.566c0 10.343 6.75 19.105 15.945 22.265 1.148.144 1.58-.574 1.58-1.15v-4.02c-6.465 1.436-7.902-3.16-7.902-3.16-1.005-2.73-2.586-3.45-2.586-3.45-2.154-1.435.144-1.435.144-1.435 2.298.144 3.59 2.442 3.59 2.442 2.156 3.59 5.46 2.586 6.753 2.01.142-1.58.86-2.585 1.435-3.16-5.17-.574-10.63-2.585-10.63-11.635 0-2.585.862-4.596 2.442-6.32-.287-.575-1.005-3.017.288-6.177 0 0 2.01-.574 6.464 2.442 1.866-.574 3.877-.718 5.888-.718 2.01 0 4.022.286 5.89.717 4.453-3.016 6.464-2.442 6.464-2.442 1.293 3.16.43 5.602.287 6.177a9.29 9.29 0 012.44 6.32c0 9.05-5.458 10.918-10.63 11.492.863.718 1.58 2.155 1.58 4.31v6.464c0 .574.432 1.292 1.58 1.15 9.338-3.16 15.946-11.924 15.946-22.266-.143-12.785-10.63-23.27-23.558-23.27z"fill=currentcolor fill-rule=evenodd clip-rule=evenodd /></svg></a></ol><ol class="row justify-end-l"><li><a href="https://bundlephobia.com/result?p=remark-redactable"class=tap-target>981 B</a><li><a href="https://bundlephobia.com/result?p=remark-redactable"class=tap-target>CJS</a><li><a href=https://www.npmtrends.com/remark-redactable class=tap-target><svg class=icon height=18 viewBox="1 1 8 14"width=18 aria-label=downloads role=img><path d="M7 7V3H3v4H0l5 6 5-6H7z"fill=currentcolor fill-rule=evenodd /></svg> 37</a><li><a href=https://www.npmjs.com/package/remark-redactable class=tap-target><svg class=icon height=18 viewBox="3.8 3.8 19.7 19.7"width=18 aria-label=npm role=img><path d="M5.8 21.75h7.86l.01-11.77h3.92l-.01 11.78h3.93l.01-15.7-15.7-.02-.02 15.71z"fill=currentcolor /></svg></a></ol></div></div><div class=block><ol class=flow></ol></div></section><main class=container><div class="content readme"><h1 id=remark-redactable><a href=#remark-redactable class=anchor aria-label="Link to self"><svg class=icon height=18 viewBox="0 0 50 50"width=18 aria-hidden=true><path d="M45.647 20.955L33.339 33.263a8.7 8.7 0 01-12.308 0l-4.103-4.103 4.103-4.102 4.102 4.102a2.903 2.903 0 004.103 0l12.307-12.307a2.907 2.907 0 000-4.104l-4.102-4.103a2.906 2.906 0 00-4.103 0l-4.394 4.395a11.542 11.542 0 00-6.644-1.559l6.936-6.938c3.4-3.399 8.91-3.399 12.307 0l4.103 4.102a8.702 8.702 0 010 12.309zM21.32 37.076l-4.392 4.391a2.903 2.903 0 01-4.102 0l-4.103-4.102a2.9 2.9 0 010-4.103L21.03 20.954a2.906 2.906 0 014.103 0l4.102 4.103 4.102-4.103-4.102-4.102a8.704 8.704 0 00-12.308 0L4.621 29.159a8.7 8.7 0 000 12.308l4.102 4.102c3.397 3.4 8.908 3.4 12.308 0l6.936-6.936a11.602 11.602 0 01-6.647-1.558z"fill=currentcolor /></svg></a>remark-redactable</h1><p><a href=https://travis-ci.org/code-dot-org/remark-redactable/ rel="nofollow noopener noreferrer"><img alt="Travis Build Status"src=https://img.shields.io/travis/code-dot-org/remark-redactable/master.svg></a> <a href=#><img alt="npm version"src=https://img.shields.io/npm/v/remark-redactable.svg></a><p>A plugin that allows sensitive information or complex syntax in markdown documents to be removed ("redacted") from the document, then reattached ("restored") to the document at some later point.<p>Used by <a href=https://code.org/ rel="nofollow noopener noreferrer">code.org</a> via <a href=https://github.com/code-dot-org/redactable-markdown rel="nofollow noopener noreferrer"><code>redactable-markdown</code></a> to enable better internationalization of sensitive, controlled, or complex content.<h2 id=usage><a href=#usage class=anchor aria-label="Link to self"><svg class=icon height=18 viewBox="0 0 50 50"width=18 aria-hidden=true><path d="M45.647 20.955L33.339 33.263a8.7 8.7 0 01-12.308 0l-4.103-4.103 4.103-4.102 4.102 4.102a2.903 2.903 0 004.103 0l12.307-12.307a2.907 2.907 0 000-4.104l-4.102-4.103a2.906 2.906 0 00-4.103 0l-4.394 4.395a11.542 11.542 0 00-6.644-1.559l6.936-6.938c3.4-3.399 8.91-3.399 12.307 0l4.103 4.102a8.702 8.702 0 010 12.309zM21.32 37.076l-4.392 4.391a2.903 2.903 0 01-4.102 0l-4.103-4.102a2.9 2.9 0 010-4.103L21.03 20.954a2.906 2.906 0 014.103 0l4.102 4.103 4.102-4.103-4.102-4.102a8.704 8.704 0 00-12.308 0L4.621 29.159a8.7 8.7 0 000 12.308l4.102 4.102c3.397 3.4 8.908 3.4 12.308 0l6.936-6.936a11.602 11.602 0 01-6.647-1.558z"fill=currentcolor /></svg></a>Usage</h2><p>This example redacts a source string, then restores a translated version of that redaction with the original content from the source string.<pre><code class="hljs language-javascript"><span class=hljs-keyword>const</span> remark = <span class=hljs-built_in>require</span>(<span class=hljs-string>'remark'</span>)
<span class=hljs-keyword>const</span> { redact, restore, plugins } = <span class=hljs-built_in>require</span>(<span class=hljs-string>'remark-redactable'</span>);

<span class=hljs-keyword>const</span> sourceText = <span class=hljs-string>"A [black](http://black.com) [cat](http://cat.com)\n"</span>;
<span class=hljs-built_in>console</span>.log(<span class=hljs-string>`source: <span class=hljs-subst>${sourceText}</span>`</span>);

<span class=hljs-keyword>const</span> redactedSourceTree = remark()
  .use(redact)
  .use(plugins.redactedLink)
  .parse(sourceText);

<span class=hljs-keyword>const</span> redactedText = remark()
  .use(redact)
  .stringify(redactedSourceTree);

<span class=hljs-built_in>console</span>.log(<span class=hljs-string>`redacted: <span class=hljs-subst>${redactedText}</span>`</span>);
<span class=hljs-keyword>const</span> translatedText = <span class=hljs-string>"Une [chat][1] [noir][0]\n"</span>;
<span class=hljs-built_in>console</span>.log(<span class=hljs-string>`translated redacted: <span class=hljs-subst>${translatedText}</span>`</span>);

<span class=hljs-keyword>const</span> restoredText = remark()
  .use(restore(redactedSourceTree))
  .use(plugins.redactedLink)
  .processSync(translatedText).contents;

<span class=hljs-built_in>console</span>.log(<span class=hljs-string>`restored translation: <span class=hljs-subst>${restoredText}</span>`</span>);
</code></pre><p>Yields<pre><code>source: A [black](http://black.com) [cat](http://cat.com)

redacted: A [black][0] [cat][1]

translated redacted: Une [chat][1] [noir][0]

restored translation: Une [chat](http://cat.com) [noir](http://black.com)
</code></pre><h2 id=overview><a href=#overview class=anchor aria-label="Link to self"><svg class=icon height=18 viewBox="0 0 50 50"width=18 aria-hidden=true><path d="M45.647 20.955L33.339 33.263a8.7 8.7 0 01-12.308 0l-4.103-4.103 4.103-4.102 4.102 4.102a2.903 2.903 0 004.103 0l12.307-12.307a2.907 2.907 0 000-4.104l-4.102-4.103a2.906 2.906 0 00-4.103 0l-4.394 4.395a11.542 11.542 0 00-6.644-1.559l6.936-6.938c3.4-3.399 8.91-3.399 12.307 0l4.103 4.102a8.702 8.702 0 010 12.309zM21.32 37.076l-4.392 4.391a2.903 2.903 0 01-4.102 0l-4.103-4.102a2.9 2.9 0 010-4.103L21.03 20.954a2.906 2.906 0 014.103 0l4.102 4.103 4.102-4.103-4.102-4.102a8.704 8.704 0 00-12.308 0L4.621 29.159a8.7 8.7 0 000 12.308l4.102 4.102c3.397 3.4 8.908 3.4 12.308 0l6.936-6.936a11.602 11.602 0 01-6.647-1.558z"fill=currentcolor /></svg></a>Overview</h2><p>The standard operation that can be done on a piece of markdown content is Rendering; the act of parsing the markdown content into an understandable structure and compiling that structure out to (usually) HTML.<p>To facilitate better translation of markdown, we add two new operations: Redaction and Restoration<h2 id=redaction><a href=#redaction class=anchor aria-label="Link to self"><svg class=icon height=18 viewBox="0 0 50 50"width=18 aria-hidden=true><path d="M45.647 20.955L33.339 33.263a8.7 8.7 0 01-12.308 0l-4.103-4.103 4.103-4.102 4.102 4.102a2.903 2.903 0 004.103 0l12.307-12.307a2.907 2.907 0 000-4.104l-4.102-4.103a2.906 2.906 0 00-4.103 0l-4.394 4.395a11.542 11.542 0 00-6.644-1.559l6.936-6.938c3.4-3.399 8.91-3.399 12.307 0l4.103 4.102a8.702 8.702 0 010 12.309zM21.32 37.076l-4.392 4.391a2.903 2.903 0 01-4.102 0l-4.103-4.102a2.9 2.9 0 010-4.103L21.03 20.954a2.906 2.906 0 014.103 0l4.102 4.103 4.102-4.103-4.102-4.102a8.704 8.704 0 00-12.308 0L4.621 29.159a8.7 8.7 0 000 12.308l4.102 4.102c3.397 3.4 8.908 3.4 12.308 0l6.936-6.936a11.602 11.602 0 01-6.647-1.558z"fill=currentcolor /></svg></a>Redaction</h2><p>Redaction is the process of parsing markdown content into an understandable form, then compiling that structure back out to markdown with some values removed and some syntaxes simplified.<p>For example, standard markdown links and images:<pre><code>[a link](http://example.com)
![an image](http://example.com/img.jpg)
</code></pre><p>Have their url and href values removed in the redaction process, and in the case of images the special <code>!</code> character is also removed; simplifying them to just:<pre><code>[a link][0]
[an image][1]
</code></pre><p>The result is that translators are exposed to just those parts of the original content that we actually want them to translate. This means on our end that we can do much less work to verify that translators are not breaking anything or introducing malicious content, and on the translator's end it means they need to worry much less about trying to determine which parts of the string they should and should not be responsible for changing.<p>In general, content is always redacted to two sets of square brackets, the first enclosing whatever english text we want to expose to the translators and the second enclosing a unique numeric ID we use to associate the redacted content back with the original data during the restoration process.<h2 id=restoration><a href=#restoration class=anchor aria-label="Link to self"><svg class=icon height=18 viewBox="0 0 50 50"width=18 aria-hidden=true><path d="M45.647 20.955L33.339 33.263a8.7 8.7 0 01-12.308 0l-4.103-4.103 4.103-4.102 4.102 4.102a2.903 2.903 0 004.103 0l12.307-12.307a2.907 2.907 0 000-4.104l-4.102-4.103a2.906 2.906 0 00-4.103 0l-4.394 4.395a11.542 11.542 0 00-6.644-1.559l6.936-6.938c3.4-3.399 8.91-3.399 12.307 0l4.103 4.102a8.702 8.702 0 010 12.309zM21.32 37.076l-4.392 4.391a2.903 2.903 0 01-4.102 0l-4.103-4.102a2.9 2.9 0 010-4.103L21.03 20.954a2.906 2.906 0 014.103 0l4.102 4.103 4.102-4.103-4.102-4.102a8.704 8.704 0 00-12.308 0L4.621 29.159a8.7 8.7 0 000 12.308l4.102 4.102c3.397 3.4 8.908 3.4 12.308 0l6.936-6.936a11.602 11.602 0 01-6.647-1.558z"fill=currentcolor /></svg></a>Restoration</h2><p>After redacting content and sending the redacted content out to be translated, we will get back a translated version of the redacted content. We then combine that with the original content to create a restored translated version of the original content.<p>For example, standard markdown links and images:<pre><code>[a link](http://example.com)
![an image](http://example.com/img.jpg)
</code></pre><p>After getting redacted and translated, might come back looking like:<pre><code>[un linke][0]
[une image][1]
</code></pre><p>And would then be recombined with the original content to produce:<pre><code>[un linke](http://example.com)
![une image](http://example.com/img.jpg)
</code></pre><p>Note that the unique identifiers for each piece of redacted content allow us to handle any reordering that might be introduced by the translation process. For example,<pre><code>A [black](http://example.com/black) [cat](http://example.com/cat)
</code></pre><p>Would be redacted to<pre><code>A [black][0] [cat][1]
</code></pre><p>Then translated to<pre><code>Un [chat][1] [noir][0]
</code></pre><p>Then restored to<pre><code>Un [chat](http://example.com/cat) [noir](http://example.com/black)
</code></pre><h2 id=plugins><a href=#plugins class=anchor aria-label="Link to self"><svg class=icon height=18 viewBox="0 0 50 50"width=18 aria-hidden=true><path d="M45.647 20.955L33.339 33.263a8.7 8.7 0 01-12.308 0l-4.103-4.103 4.103-4.102 4.102 4.102a2.903 2.903 0 004.103 0l12.307-12.307a2.907 2.907 0 000-4.104l-4.102-4.103a2.906 2.906 0 00-4.103 0l-4.394 4.395a11.542 11.542 0 00-6.644-1.559l6.936-6.938c3.4-3.399 8.91-3.399 12.307 0l4.103 4.102a8.702 8.702 0 010 12.309zM21.32 37.076l-4.392 4.391a2.903 2.903 0 01-4.102 0l-4.103-4.102a2.9 2.9 0 010-4.103L21.03 20.954a2.906 2.906 0 014.103 0l4.102 4.103 4.102-4.103-4.102-4.102a8.704 8.704 0 00-12.308 0L4.621 29.159a8.7 8.7 0 000 12.308l4.102 4.102c3.397 3.4 8.908 3.4 12.308 0l6.936-6.936a11.602 11.602 0 01-6.647-1.558z"fill=currentcolor /></svg></a>Plugins</h2><p>To define redaction and restoration functionality for a new or existing piece of syntax, simply create a plugin. Plugins start as remark-parse plugins of the form described in <a href=/explore/package/remark-parse/#extending-the-parser>remark-parse Extending the Parser</a>, and examples can be found <a href=https://github.com/code-dot-org/remark-redactable/blob/master/src/plugins/ rel="nofollow noopener noreferrer">in the source tree</a>.<h3 id=basic-redaction-example><a href=#basic-redaction-example class=anchor aria-label="Link to self"><svg class=icon height=18 viewBox="0 0 50 50"width=18 aria-hidden=true><path d="M45.647 20.955L33.339 33.263a8.7 8.7 0 01-12.308 0l-4.103-4.103 4.103-4.102 4.102 4.102a2.903 2.903 0 004.103 0l12.307-12.307a2.907 2.907 0 000-4.104l-4.102-4.103a2.906 2.906 0 00-4.103 0l-4.394 4.395a11.542 11.542 0 00-6.644-1.559l6.936-6.938c3.4-3.399 8.91-3.399 12.307 0l4.103 4.102a8.702 8.702 0 010 12.309zM21.32 37.076l-4.392 4.391a2.903 2.903 0 01-4.102 0l-4.103-4.102a2.9 2.9 0 010-4.103L21.03 20.954a2.906 2.906 0 014.103 0l4.102 4.103 4.102-4.103-4.102-4.102a8.704 8.704 0 00-12.308 0L4.621 29.159a8.7 8.7 0 000 12.308l4.102 4.102c3.397 3.4 8.908 3.4 12.308 0l6.936-6.936a11.602 11.602 0 01-6.647-1.558z"fill=currentcolor /></svg></a>Basic Redaction Example</h3><p>For example, let's add redaction to the <code>mention</code> plugin in the remark-parse example. We start with <code>mention.js</code> from that example:<pre><code class="hljs language-javascript"><span class=hljs-built_in>module</span>.exports = mentions;

<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>mentions</span>(<span class=hljs-params></span>) </span>{
  <span class=hljs-keyword>var</span> Parser = <span class=hljs-keyword>this</span>.Parser;
  <span class=hljs-keyword>var</span> tokenizers = Parser.prototype.inlineTokenizers;
  <span class=hljs-keyword>var</span> methods = Parser.prototype.inlineMethods;

  <span class=hljs-comment>/* Add an inline tokenizer (defined in the following example). */</span>
  tokenizers.mention = tokenizeMention;

  <span class=hljs-comment>/* Run it just before `text`. */</span>
  methods.splice(methods.indexOf(<span class=hljs-string>'text'</span>), <span class=hljs-number>0</span>, <span class=hljs-string>'mention'</span>);
}

tokenizeMention.notInLink = <span class=hljs-literal>true</span>;
tokenizeMention.locator = locateMention;

<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>tokenizeMention</span>(<span class=hljs-params>eat, value, silent</span>) </span>{
  <span class=hljs-keyword>var</span> match = <span class=hljs-regexp>/^@(\w+)/</span>.exec(value);

  <span class=hljs-keyword>if</span> (match) {
    <span class=hljs-keyword>if</span> (silent) {
      <span class=hljs-keyword>return</span> <span class=hljs-literal>true</span>;
    }

    <span class=hljs-keyword>return</span> eat(match[<span class=hljs-number>0</span>])({
      <span class=hljs-attr>type</span>: <span class=hljs-string>'link'</span>,
      <span class=hljs-attr>url</span>: <span class=hljs-string>'https://social-network/'</span> + match[<span class=hljs-number>1</span>],
      <span class=hljs-attr>children</span>: [{<span class=hljs-attr>type</span>: <span class=hljs-string>'text'</span>, <span class=hljs-attr>value</span>: match[<span class=hljs-number>0</span>]}]
    });
  }
}

<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>locateMention</span>(<span class=hljs-params>value, fromIndex</span>) </span>{
  <span class=hljs-keyword>return</span> value.indexOf(<span class=hljs-string>'@'</span>, fromIndex);
}
</code></pre><p>First, isolate the logic that extracts meaningful data from the parsed token from the logic that builds a node from that extracted data:<pre><code class="hljs language-diff">diff --git a/mention.js b/mention.js
<span class=hljs-comment>--- a/mention.js</span>
<span class=hljs-comment>+++ b/mention.js</span>
@@ -23,14 +29,19 @@ function tokenizeMention(eat, value, silent) {
       return true;
     }

<span class=hljs-deletion>-    return eat(match[0])({</span>
<span class=hljs-deletion>-      type: 'link',</span>
<span class=hljs-deletion>-      url: 'https://social-network/' + match[1],</span>
<span class=hljs-deletion>-      children: [{type: 'text', value: match[0]}]</span>
<span class=hljs-deletion>-    });</span>
<span class=hljs-addition>+    var add = eat(match[0]);</span>
<span class=hljs-addition>+    return createMention(add, match[1], match[0]);</span>
   }
 }

 function locateMention(value, fromIndex) {
   return value.indexOf('@', fromIndex);
 }
<span class=hljs-addition>+</span>
<span class=hljs-addition>+function createMention(add, name, text) {</span>
<span class=hljs-addition>+  return add({</span>
<span class=hljs-addition>+    type: 'link',</span>
<span class=hljs-addition>+    url: 'https://social-network/' + name,</span>
<span class=hljs-addition>+    children: [{type: 'text', value: text}]</span>
<span class=hljs-addition>+  });</span>
<span class=hljs-addition>+}</span>
</code></pre><p>Then, conditionally create a <code>redaction</code> node instead of the desired regular node when in redaction mode (see more about the <code>redaction</code> node <a href=https://github.com/code-dot-org/remark-redactable/blob/master/docs/mdast-nodes.md rel="nofollow noopener noreferrer">here</a>):<p>Note here that all that is required of the redaction node is that it contains a unique <code>redactionType</code> identifier, and any information required to recreate the node.<pre><code class="hljs language-diff">diff --git a/mention.js b/mention.js
<span class=hljs-comment>--- a/mention.js</span>
<span class=hljs-comment>+++ b/mention.js</span>
<span class=hljs-meta>@@ -1,10 +1,15 @@</span>
 module.exports = mentions;

<span class=hljs-addition>+var redact;</span>
<span class=hljs-addition>+</span>
 function mentions() {
   var Parser = this.Parser;
   var tokenizers = Parser.prototype.inlineTokenizers;
   var methods = Parser.prototype.inlineMethods;

<span class=hljs-addition>+  /* Make the Parser's redact option visible to the tokenizer */</span>
<span class=hljs-addition>+  redact = Parser.prototype.options.redact;</span>
<span class=hljs-addition>+</span>
   /* Add an inline tokenizer (defined in the following example). */
   tokenizers.mention = tokenizeMention;

@@ -24,7 +29,19 @@ function tokenizeMention(eat, value, silent) {
     }

     var add = eat(match[0]);
<span class=hljs-deletion>-    return createMention(add, match[1], match[0]);</span>
<span class=hljs-addition>+    var name = match[1];</span>
<span class=hljs-addition>+    var text = match[0];</span>
<span class=hljs-addition>+</span>
<span class=hljs-addition>+    if (redact) {</span>
<span class=hljs-addition>+      return add({</span>
<span class=hljs-addition>+        type: 'inlineRedaction',</span>
<span class=hljs-addition>+        redactionType: 'mention',</span>
<span class=hljs-addition>+        redactionData: {</span>
<span class=hljs-addition>+          name: name,</span>
<span class=hljs-addition>+          text: text</span>
<span class=hljs-addition>+        }</span>
<span class=hljs-addition>+      });</span>
<span class=hljs-addition>+    }</span>
<span class=hljs-addition>+</span>
<span class=hljs-addition>+    return createMention(add, name, text);</span>
   }
 }
</code></pre><p>Finally, add a restoration method for the specified redaction type, using the newly-isolated node creation logic.<pre><code class="hljs language-diff">diff --git a/mention.js b/mention.js
<span class=hljs-comment>--- a/mention.js</span>
<span class=hljs-comment>+++ b/mention.js</span>
@@ -6,6 +6,11 @@ function mentions() {
   var Parser = this.Parser;
   var tokenizers = Parser.prototype.inlineTokenizers;
   var methods = Parser.prototype.inlineMethods;
<span class=hljs-addition>+  var restorationMethods = Parser.prototype.restorationMethods;</span>
<span class=hljs-addition>+</span>
<span class=hljs-addition>+  if (restorationMethods) {</span>
<span class=hljs-addition>+    restorationMethods.mention = function (add, node) {</span>
<span class=hljs-addition>+      return createMention(add, node.redactionData.name, node.redactionData.text);</span>
<span class=hljs-addition>+    }</span>
<span class=hljs-addition>+  }</span>

   /* Make the Parser's redact option visible to the tokenizer */
   redact = Parser.prototype.options.redact;
</code></pre><p>We can now redact and restore <code>@</code> mentions:<pre><code class="hljs language-javascript"><span class=hljs-keyword>const</span> remark = <span class=hljs-built_in>require</span>(<span class=hljs-string>'remark'</span>)
<span class=hljs-keyword>const</span> { redact, restore } = <span class=hljs-built_in>require</span>(<span class=hljs-string>'remark-redactable'</span>);
<span class=hljs-keyword>const</span> mention = <span class=hljs-built_in>require</span>(<span class=hljs-string>'mention'</span>);

<span class=hljs-keyword>const</span> sourceText = <span class=hljs-string>"Hello @example"</span>;

<span class=hljs-keyword>const</span> redactedSourceTree = remark()
  .use(redact)
  .use(mention)
  .parse(sourceText);

<span class=hljs-keyword>const</span> redactedText = remark()
  .use(redact)
  .stringify(redactedSourceTree); <span class=hljs-comment>// "Hello [][0]"</span>

<span class=hljs-keyword>const</span> translatedText = redactedText
  .replace(<span class=hljs-string>"Hello"</span>, <span class=hljs-string>"Bonjour"</span>); <span class=hljs-comment>// "Bonjour [][0]"</span>

<span class=hljs-keyword>const</span> restoredText = remark()
  .use(restore(redactedSourceTree))
  .use(plugins.redactedLink)
  .processSync(translatedText)
  .contents; <span class=hljs-comment>// "Bonjour [@example](https://social-network/example)"</span>
</code></pre><h3 id=advanced-redaction-example><a href=#advanced-redaction-example class=anchor aria-label="Link to self"><svg class=icon height=18 viewBox="0 0 50 50"width=18 aria-hidden=true><path d="M45.647 20.955L33.339 33.263a8.7 8.7 0 01-12.308 0l-4.103-4.103 4.103-4.102 4.102 4.102a2.903 2.903 0 004.103 0l12.307-12.307a2.907 2.907 0 000-4.104l-4.102-4.103a2.906 2.906 0 00-4.103 0l-4.394 4.395a11.542 11.542 0 00-6.644-1.559l6.936-6.938c3.4-3.399 8.91-3.399 12.307 0l4.103 4.102a8.702 8.702 0 010 12.309zM21.32 37.076l-4.392 4.391a2.903 2.903 0 01-4.102 0l-4.103-4.102a2.9 2.9 0 010-4.103L21.03 20.954a2.906 2.906 0 014.103 0l4.102 4.103 4.102-4.103-4.102-4.102a8.704 8.704 0 00-12.308 0L4.621 29.159a8.7 8.7 0 000 12.308l4.102 4.102c3.397 3.4 8.908 3.4 12.308 0l6.936-6.936a11.602 11.602 0 01-6.647-1.558z"fill=currentcolor /></svg></a>Advanced Redaction Example</h3><p>We also have the option of allowing the redaction and restoration process to change the way the parsed text is processed.<p>Say we wanted the redacted version of the basic example to expose the <code>@</code> name like:<pre><code>Hello [@example][0]
</code></pre><p>And for changes made to the text in the redaction to be reflected in the generated link like:<pre><code>Bonjour [@exemple][0] > Bonjour [@exemple](https://social-network/example)
</code></pre><p>To achieve that, we first move the <code>text</code> value from a property on the <code>redaction</code> node to a full <code>text</code> child node:<pre><code class="hljs language-diff">diff --git a/mention.js b/mention.js
<span class=hljs-comment>--- a/mention.js</span>
<span class=hljs-comment>+++ b/mention.js</span>
@@ -42,7 +42,11 @@ function tokenizeMention(eat, value, silent) {
         type: 'redaction',
         redactionType: 'mention',
         redactionData: {
           name: name,
<span class=hljs-deletion>-          text: text</span>
         },
<span class=hljs-addition>+        redactionContent: [{</span>
<span class=hljs-addition>+          type: 'text',</span>
<span class=hljs-addition>+          value: text</span>
<span class=hljs-addition>+        }]</span>
       });
     }
</code></pre><p>Then, we expand the restoration method to make use of the optional <code>content</code> argument, which will contain the modified version of the text content.<pre><code class="hljs language-diff">diff --git a/mention.js b/mention.js
<span class=hljs-comment>--- a/mention.js</span>
<span class=hljs-comment>+++ b/mention.js</span>
@@ -8,8 +8,8 @@ function mentions() {
   var methods = Parser.prototype.inlineMethods;
   var restorationMethods = Parser.prototype.restorationMethods;

   if (restorationMethods) {
<span class=hljs-deletion>-    restorationMethods.mention = function (add, node) {</span>
<span class=hljs-deletion>-      return createMention(add, node.redactionData.name, node.redactionData.text);</span>
<span class=hljs-addition>+    restorationMethods.mention = function (add, node, content) {</span>
<span class=hljs-addition>+      return createMention(add, node.redactionData.name, content);</span>
     }
   }

   /* Make the Parser's redact option visible to the tokenizer */
</code></pre><p>The result:<pre><code class="hljs language-javascript">$ echo <span class=hljs-string>"Hello @example"</span> > source.md
$ redact source.md -p mention.js | tee redacted.md
Hello [@example][<span class=hljs-number>0</span>]
$ sed -e <span class=hljs-string>'s/Hello/Bonjour/'</span> -e <span class=hljs-string>'s/example/exemple/'</span> redacted.md | tee translated.md
Bonjour [@exemple][<span class=hljs-number>0</span>]
$ restore -s source.md -r translated.md -p mention.js
Bonjour [@exemple](https:<span class=hljs-comment>//social-network/example)</span>

<span class=hljs-keyword>const</span> remark = <span class=hljs-built_in>require</span>(<span class=hljs-string>'remark'</span>)
<span class=hljs-keyword>const</span> { redact, restore } = <span class=hljs-built_in>require</span>(<span class=hljs-string>'remark-redactable'</span>);
<span class=hljs-keyword>const</span> mention = <span class=hljs-built_in>require</span>(<span class=hljs-string>'mention'</span>);

<span class=hljs-keyword>const</span> sourceText = <span class=hljs-string>"Hello @example"</span>;

<span class=hljs-keyword>const</span> redactedSourceTree = remark()
  .use(redact)
  .use(mention)
  .parse(sourceText);

<span class=hljs-keyword>const</span> redactedText = remark()
  .use(redact)
  .stringify(redactedSourceTree); <span class=hljs-comment>// "Hello [@example][0]"</span>

<span class=hljs-keyword>const</span> translatedText = redactedText
  .replace(<span class=hljs-string>"Hello"</span>, <span class=hljs-string>"Bonjour"</span>)
  .replace(<span class=hljs-string>"example"</span>, <span class=hljs-string>"exemple"</span>); <span class=hljs-comment>// "Bonjour [@exemple][0]"</span>

<span class=hljs-keyword>const</span> restoredText = remark()
  .use(restore(redactedSourceTree))
  .use(plugins.redactedLink)
  .processSync(translatedText)
  .contents; <span class=hljs-comment>// "Bonjour [@exemple](https://social-network/example)"</span>

</code></pre></div></main><footer class=container><nav class="flex row-l"><ol class="row flex x-show-l"><li><a href=/ class=unified><span class=hl>uni</span>fied</a><li><a href=/explore/>Explore</a><li><a href=/learn/>Learn</a><li><a href=/community/>Community</a></ol><ol class="row justify-end-l"><li><a href=https://spectrum.chat/unified>Spectrum</a><li><a href=https://opencollective.com/unified>OpenCollective</a><li><a href=https://twitter.com/unifiedjs>Twitter</a><li><a href=https://github.com/unifiedjs>GitHub</a></ol></nav></footer>